let paso=1;const cita={id:"",nombre:"",fecha:"",hora:"",servicios:[]};document.addEventListener("DOMContentLoaded",(()=>{iniciarApp()}));const iniciarApp=()=>{tabs(),mostrarSeccion(),paginador(),paginaSiguiente(),paginaAnterior(),consultarAPI(),idCliente(),nombreCliente(),seleccionarFecha(),seleccionarHora(),mostrarResumen()},mostrarSeccion=()=>{const e=document.querySelectorAll(".tabs button"),t=document.querySelectorAll(".seccion"),a=`#paso-${paso}`,o=document.querySelector(a),r=document.querySelector(`[data-paso="${paso}"]`);t.forEach((e=>{e.classList.remove("mostrar")})),o.classList.add("mostrar"),e.forEach((e=>{e.classList.remove("actual")})),r.classList.add("actual")},tabs=()=>{document.querySelectorAll(".tabs button").forEach((e=>{e.addEventListener("click",(e=>{paso=parseInt(e.target.dataset.paso),mostrarSeccion(),paginador()}))}))},paginador=()=>{const e=document.querySelector("#anterior"),t=document.querySelector("#siguiente");switch(paso){case 1:default:e.classList.add("ocultar"),t.classList.remove("ocultar");break;case 2:e.classList.remove("ocultar"),t.classList.remove("ocultar");break;case 3:e.classList.remove("ocultar"),t.classList.add("ocultar"),mostrarResumen()}mostrarSeccion()},paginaAnterior=()=>{document.querySelector("#anterior").addEventListener("click",(()=>{paso>0&&paso--,paginador()}))},paginaSiguiente=()=>{document.querySelector("#siguiente").addEventListener("click",(()=>{paso<3&&paso++,paginador()}))},consultarAPI=async()=>{try{const e=`${location.origin}/api/servicios`,t=await fetch(e),a=await t.json();mostrarServicios(a)}catch(e){console.log(e)}},mostrarServicios=e=>{e.forEach((e=>{const{id:t,nombre:a,precio:o}=e,r=document.createElement("p"),c=document.createElement("p"),n=document.createElement("div"),i=document.querySelector("#servicios");r.classList.add("nombre-servicio"),r.textContent=a,c.classList.add("precio-servicio"),c.textContent="$"+o,n.classList.add("servicio"),n.dataset.idServicio=t,n.onclick=()=>{seleccionarServicio(e)},n.appendChild(r),n.appendChild(c),i.appendChild(n)}))},seleccionarServicio=e=>{const{id:t}=e,{servicios:a}=cita,o=document.querySelector(`[data-id-servicio="${t}"]`);a.some((e=>e.id===t))?(cita.servicios=a.filter((e=>e.id!==t)),o.classList.remove("seleccionado")):(cita.servicios=[...a,e],o.classList.add("seleccionado"))},idCliente=()=>{const e=document.querySelector("#id").value;cita.id=e},nombreCliente=()=>{const e=document.querySelector("#nombre").value;cita.nombre=e},seleccionarFecha=()=>{let e;document.querySelector("#fecha").addEventListener("input",(t=>{e=new Date(t.target.value).getUTCDay(),[6,0].includes(e)?(t.target.value="",mostrarAlerta("error",".formulario","Sábados y Domingos no abrimos")):cita.fecha=t.target.value}))},seleccionarHora=()=>{document.querySelector("#hora").addEventListener("input",(e=>{const t=e.target.value,a=t.split(":")[0];a<10||a>18?(e.target.value="",mostrarAlerta("error",".formulario","Hora no válida")):cita.hora=t}))},mostrarAlerta=(e,t,a,o=!0)=>{const r=document.createElement("div"),c=document.querySelector(".alerta"),n=document.querySelector(t);c&&c.remove(),r.textContent=a,r.classList.add("alerta"),r.classList.add(e),n.appendChild(r),o&&setTimeout((()=>{r.remove()}),3e3)},mostrarResumen=()=>{const e=document.querySelector(".contenido-resumen");for(;e.firstChild;)e.removeChild(e.firstChild);if(Object.values(cita).includes("")||0===cita.servicios.length)return void mostrarAlerta("error",".contenido-resumen","Hacen falta datos o Servicios",!1);const{nombre:t,fecha:a,hora:o,servicios:r}=cita,c=document.createElement("p"),n=document.createElement("p"),i=document.createElement("p"),s=document.createElement("h3");s.textContent="Resumen de Servicios",e.appendChild(s),r.forEach((t=>{const{id:a,precio:o,nombre:r}=t,c=document.createElement("div"),n=document.createElement("p"),i=document.createElement("p");c.classList.add("contenedor-servicio"),n.textContent=r,i.innerHTML=`<span>Precio:</span> $${o}`,c.appendChild(n),c.appendChild(i),e.appendChild(c)}));const d=document.createElement("h3");d.textContent="Resumen de Cita",e.appendChild(d);const l=new Date(a),u=l.getDate(),m=l.getMonth(),p=l.getFullYear(),v=new Date(Date.UTC(p,m,u)).toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"});c.innerHTML=`<span>Nombre:</span> ${t}`,n.innerHTML=`<span>Fecha:</span> ${v}`,i.innerHTML=`<span>Hora:</span> ${o}`;const h=document.createElement("button");h.classList.add("boton"),h.textContent="Reservar Cita",h.onclick=reservarCita,e.appendChild(c),e.appendChild(n),e.appendChild(i),e.appendChild(h)},reservarCita=async()=>{const{fecha:e,hora:t,servicios:a,id:o}=cita,r=a.map((e=>e.id)),c=new FormData;c.append("fecha",e),c.append("hora",t),c.append("servicios",r),c.append("usuario_id",o);try{const e=`${location.origin}/api/citas`,t=await fetch(e,{method:"POST",body:c});(await t.json()).resultado&&Swal.fire({icon:"success",title:"Cita Creada",text:"Tu cita fue creada correctamente",button:"Ok"}).then((()=>{window.location.reload()}))}catch(e){Swal.fire({icon:"error",title:"Error",text:"Hubo un error al guardar la cita",button:"Ok"})}};